<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.j4h.mall.mapper.category.CategoryMapper">

  <select id="getL1Category" resultType="com.j4h.mall.model.category.L1Name">
    select id as `value`,`name` as lable from cskaoyan_mall_category where level = 'L1' and deleted = 0
  </select>

  <select id="queryAllCategory" resultMap="categoryMap">
    select id,icon_url as iconUrl,`desc`,keywords,`level`,`name`,pic_url as picUrl from cskaoyan_mall_category where pid = 0 and deleted = 0
  </select>
  <resultMap id="categoryMap" type="com.j4h.mall.model.category.L1Category">
    <result column="id" property="id"/>
    <result column="iconUrl" property="iconUrl"/>
    <result column="desc" property="desc"/>
    <result column="keywords" property="keywords"/>
    <result column="level" property="level"/>
    <result column="name" property="name"/>
    <result column="picUrl" property="picUrl"/>
    <collection property="children" column="id" select="com.j4h.mall.mapper.category.CategoryMapper.queryL2Category"/>
  </resultMap>
  <select id="queryL2Category" resultType="com.j4h.mall.model.category.L2Category">
    select id,icon_url as iconUrl,`desc`,keywords,`level`,`name`,pic_url as picUrl from cskaoyan_mall_category where pid = #{id} and deleted = 0
  </select>

  <insert id="createCategory">
    <selectKey resultType="_int" keyColumn="" keyProperty="result.id" order="AFTER">
      select last_insert_id() as id
    </selectKey>
    insert into cskaoyan_mall_category (name, keywords, `desc`, pid, icon_url, pic_url, level,add_time,update_time) values (#{new.name},#{new.keywords},#{new.desc},#{new.pid},#{new.iconUrl},#{new.picUrl},#{new.level},now(),now())
  </insert>
  <select id="queryCategoryById" resultType="com.j4h.mall.model.category.AddCategory">
    select id,icon_url as iconUrl,`desc`,keywords,`level`,`name`,pic_url as picUrl,add_time as addTime,update_time as updateTime from cskaoyan_mall_category where id = #{id} and deleted = 0
  </select>

  <update id="updateCategory">
    update cskaoyan_mall_category set `desc` = #{update.desc},icon_url = #{update.iconUrl},keywords = #{update.keywords},
                                      level = #{update.level},name = #{update.name},pic_url = #{update.picUrl},pid = #{update.pid},update_time = now()
    where id = #{update.id}
  </update>

  <update id="deleteCategoryByPid">
    update cskaoyan_mall_category set deleted = 1 where pid = #{pid}
  </update>
  <update id="deleteCategoryById">
    update cskaoyan_mall_category set deleted = 1 where id = #{id}
  </update>

</mapper>
